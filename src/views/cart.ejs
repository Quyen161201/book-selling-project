<!doctype html>
<html lang="en">

<head>
   <%- include ("head.ejs") %>
</head>

<body>
   <!-- loader Start -->
   <div id="loading">
      <div id="loading-center">
      </div>
   </div>
   <!-- loader END -->
   <!-- Wrapper Start -->
   <div class="wrapper">
      <!-- Sidebar  -->
      <%- include ("sidebarIndex.ejs") %>
         <!-- TOP Nav Bar -->
         <%- include ("sidebar-top-index.ejs") %>

            <!-- TOP Nav Bar END -->
            <!-- Page Content  -->

            <div id="content-page" class="content-page">
               <div class="container-fluid checkout-content">
                  <div class="row">
                     <div id="cart" class="card-block show p-0 col-12">
                        <div class="row align-item-center">
                           <div class="col-lg-9">
                              <div class="iq-card">
                                 <div class="iq-card-header d-flex justify-content-between iq-border-bottom mb-0">
                                    <div class="iq-header-title">
                                       <h4 class="card-title">Giỏ hàng</h4>
                                    </div>
                                 </div>
                                 <div class="iq-card-body">
                                    <ul class="list-inline p-0 m-0">
                                       <% if(listcart.length>0){
                                          let total=0
                                          listcart.forEach((cart,index)=> {%>
                                          <li class="checkout-product">
                                             <div class="row align-items-center">
                                                <div class="col-sm-1">
                                                   <div class="form-check">
                                                      <input class="form-check-input" type="checkbox" name="checkbox"
                                                         multiple value=" <%=cart.cartId %>" id="flexCheckIndeterminate"
                                                         onclick="checkcart(this)">

                                                   </div>
                                                </div>
                                                <div class="col-sm-2">

                                                   <span class="checkout-product-img">
                                                      <a href="javascript:void();"><img class="img-fluid rounded"
                                                            src="/images/browse-books/<%=cart.thumbnail%>" alt=""></a>
                                                   </span>
                                                </div>
                                                <div class="col-sm-3">
                                                   <div class="checkout-product-details">
                                                      <h5>
                                                         <%=cart.productName%>
                                                      </h5>
                                                      <p class="text-success">Còn hàng</p>

                                                      <div class="price">
                                                         <h5>
                                                            <%=cart.unitPrice.toLocaleString()%> ₫
                                                         </h5>
                                                      </div>
                                                   </div>
                                                </div>
                                                <div class="col-sm-6">
                                                   <div class="row">
                                                      <div class="col-sm-10">
                                                         <div class="row align-items-center mt-2">
                                                            <div class="col-sm-7 col-md-6">
                                                               <button type="button" class="fa fa-minus qty-btn"
                                                                  id="btn-minus" onblur="send(this)"></button>

                                                               <input class="quantity" name="quantity" type="text"
                                                                  onchange=" sendata(this)" id="quantity"
                                                                  value="<%=cart.quatity%>">
                                                               <input type="hidden" id="id" value="<%=cart.cartId %>">

                                                               <input type="hidden" id="price"
                                                                  value="<%=cart.unitPrice%>">
                                                               <button type="button" class="fa fa-plus qty-btn "
                                                                  id="btn-plus%> " onblur="send(this)"></button>
                                                            </div>
                                                            <div class="col-sm-5 col-md-6">
                                                               <span class="product-price">
                                                                  <%=(cart.unitPrice*cart.quatity).toLocaleString()%> ₫
                                                               </span>
                                                            </div>
                                                         </div>
                                                      </div>
                                                      <div class="col-sm-2">
                                                         <button
                                                            style="width: 24px; margin-left: 3px;margin-top: 8px; text-align: center; height: 25px; position: relative;"
                                                            type="button" class="btn btn-danger"
                                                            data-target="#deleteModal" data-toggle="modal"><i
                                                               class="ri-delete-bin-line"
                                                               style="position: absolute; top: 2px; right: 0px;"></i></button>

                                                      </div>
                                                      <div class="modal fade" id="deleteModal">
                                                         <div class="modal-dialog">
                                                            <div class="modal-content">
                                                               <div class="modal-header">
                                                                  <h5 class="modal-title" id="exampleModalLabel">
                                                                     Confirm Delete
                                                                  </h5>
                                                                  <button type="button" class="close"
                                                                     data-dismiss="modal" aria-label="Close">
                                                                     <span aria-hidden="true">&times;</span>
                                                                  </button>
                                                               </div>
                                                               <div class="modal-body">
                                                                  <p>Bạn muốn xóa sản phẩm khỏi giỏ hàng</p>
                                                               </div>
                                                               <div class="modal-footer">
                                                                  <button class="btn btn-secondary" id="close-modal"
                                                                     class="close" data-dismiss="modal"
                                                                     aria-label="Close">No</button>
                                                                  <form action="/deleteCart/<%=cart.cartId %>"
                                                                     method="post">
                                                                     <button class="btn btn-danger">Yes</button>
                                                                  </form>
                                                               </div>
                                                            </div>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                          </li>
                                          <% }); } %>
                                    </ul>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-3">
                              <div class="iq-card">
                                 <div class="iq-card-body">
                                    <p>Tùy chọn</p>
                                    <div class="d-flex justify-content-between">
                                       <span>Phiếu giảm giá</span>
                                       <span><a href="#"><strong>Áp dụng</strong></a></span>
                                    </div>
                                    <hr>
                                    <p><b>Chi tiết</b></p>
                                    <div class="d-flex justify-content-between mb-1">
                                       <span>Tổng</span>
                                       <span id="total">

                                       </span>
                                    </div>
                                    <!-- <div class="d-flex justify-content-between mb-1">
                                       <span>Giảm giá</span>
                                       <span class="text-success">19.900đ</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-1">
                                       <span>Thuế VAT</span>
                                       <span>16.900đ</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                       <span>Phí vận chuyển</span>
                                       <span class="text-success">Miễn phí</span>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between">
                                       <span class="text-dark"><strong>Tổng</strong></span>
                                       <span class="text-dark"><strong>

                                          </strong></span>
                                    </div> -->
                                    <a id="place-order" href="javascript:void();"
                                       class="btn btn-primary d-block mt-3 next" onclick="order()">Đặt hàng</a>
                                    <div class="modal" tabindex="-1">
                                       <div class="modal-dialog">
                                          <div class="modal-content">
                                             <div class="modal-header">
                                                <h5 class="modal-title">Modal title</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                   aria-label="Close"></button>
                                             </div>
                                             <div class="modal-body">
                                                <p>Modal body text goes here.</p>
                                             </div>
                                             <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                   data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-primary">Save changes</button>
                                             </div>
                                          </div>
                                       </div>
                                    </div>

                                 </div>
                              </div>
                              <div class="iq-card ">
                                 <div class="card-body iq-card-body p-0 iq-checkout-policy">
                                    <ul class="p-0 m-0">
                                       <li class="d-flex align-items-center">
                                          <div class="iq-checkout-icon">
                                             <i class="ri-checkbox-line"></i>
                                          </div>
                                          <h6>Chính sách bảo mật (Thanh toán an toàn và bảo mật.)</h6>
                                       </li>
                                       <li class="d-flex align-items-center">
                                          <div class="iq-checkout-icon">
                                             <i class="ri-truck-line"></i>
                                          </div>
                                          <h6>Chính sách giao hàng (Giao hàng tận nhà.)</h6>
                                       </li>
                                       <li class="d-flex align-items-center">
                                          <div class="iq-checkout-icon">
                                             <i class="ri-arrow-go-back-line"></i>
                                          </div>
                                          <h6>Chính sách hoàn trả</h6>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div id="address" class="card-block p-0 col-12">
                        <div class="row align-item-center">
                           <div class="col-lg-8">
                              <div class="iq-card">
                                 <div class="iq-card-header d-flex justify-content-between">
                                    <div class="iq-header-title">
                                       <h4 class="card-title">Thêm địa chỉ mới</h4>
                                    </div>
                                 </div>
                                 <div class="iq-card-body">
                                    <form onsubmit="required()">
                                       <div class="row mt-3">
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label>Họ và tên: *</label>
                                                <input type="text" class="form-control" name="fname" required="">
                                             </div>
                                          </div>
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label>Số điện thoại: *</label>
                                                <input type="text" class="form-control" name="mno" required="">
                                             </div>
                                          </div>
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label>Địa chỉ: *</label>
                                                <input type="text" class="form-control" name="houseno" required="">
                                             </div>
                                          </div>
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label>Tỉnh/thành phố: *</label>
                                                <input type="text" class="form-control" name="city" required="">
                                             </div>
                                          </div>
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label>Phường: *</label>
                                                <input type="text" class="form-control" name="state" required="">
                                             </div>
                                          </div>
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label for="addtype">Loại địa chỉ</label>
                                                <select class="form-control" id="addtype">
                                                   <option>Nhà riêng</option>
                                                   <option>Công ty</option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-6">
                                             <button id="savenddeliver" type="submit" class="btn btn-primary">Lưu và
                                                giao tại
                                                đây</button>
                                          </div>
                                       </div>
                                    </form>
                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-4">
                              <div class="iq-card">
                                 <div class="iq-card-body">
                                    <h4 class="mb-2">Ông Trần Thuận</h4>
                                    <div class="shipping-address">
                                       <p class="mb-0">11 Thành Thái</p>
                                       <p>Thành phố Đà Nẵng</p>
                                       <p>0789-999-999</p>
                                    </div>
                                    <hr>
                                    <a id="deliver-address" href="javascript:void();"
                                       class="btn btn-primary d-block mt-1 next">Tiếp tục</a>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div id="payment" class="card-block p-0 col-12">
                        <div class="row align-item-center">
                           <div class="col-lg-8">
                              <div class="iq-card">
                                 <div class="iq-card-header d-flex justify-content-between">
                                    <div class="iq-header-title">
                                       <h4 class="card-title">Lựa chọn thanh toán</h4>
                                    </div>
                                 </div>
                                 <div class="iq-card-body">
                                    <form class="mt-3">
                                       <div class="d-flex align-items-center">
                                          <span>Mã giảm giá: </span>
                                          <div class="cvv-input ml-3 mr-3">
                                             <input type="text" class="form-control" required="">
                                          </div>
                                          <button type="submit" class="btn btn-primary">Tiếp tục</button>
                                       </div>
                                    </form>
                                    <hr>
                                    <div class="card-lists">
                                       <div class="form-group">
                                          <div class="custom-control custom-radio">
                                             <input type="radio" id="credit" name="customRadio"
                                                class="custom-control-input">
                                             <label class="custom-control-label" for="credit"> Thẻ Tín dụng / Ghi nợ /
                                                ATM</label>
                                          </div>
                                          <div class="custom-control custom-radio">
                                             <input type="radio" id="netbaking" name="customRadio"
                                                class="custom-control-input">
                                             <label class="custom-control-label" for="netbaking"> Momo/ZaloPay</label>
                                          </div>
                                          <div class="custom-control custom-radio">
                                             <input type="radio" id="emi" name="emi" class="custom-control-input">
                                             <label class="custom-control-label" for="emi"> Trả góp</label>
                                          </div>
                                          <div class="custom-control custom-radio">
                                             <input type="radio" id="cod" name="cod" class="custom-control-input">
                                             <label class="custom-control-label" for="cod"> Thanh toán khi giao hàng
                                             </label>
                                          </div>
                                       </div>
                                    </div>
                                    <hr>
                                    <a id="deliver-address" href="javascript:void();"
                                       class="btn btn-primary d-block mt-1 next">Thanh toán</a>

                                 </div>
                              </div>
                           </div>
                           <div class="col-lg-4">
                              <div class="iq-card">
                                 <div class="iq-card-body">
                                    <h4 class="mb-2">Chi tiết</h4>
                                    <div class="d-flex justify-content-between">
                                       <span>Giá 3 sản phẩm</span>
                                       <span><strong>329.900đ</strong></span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                       <span>Phí vận chuyển</span>
                                       <span class="text-success">Miễn phí</span>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between">
                                       <span>Số tiền phải trả</span>
                                       <span><strong>329.900đ</strong></span>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
   </div>
   <!-- Wrapper END -->
   <!-- Footer -->
   <footer class="iq-footer">
      <div class="container-fluid">
         <div class="row">
            <div class="col-lg-6">
               <ul class="list-inline mb-0">
                  <li class="list-inline-item"><a href="privacy-policy.html">Chính sách bảo mật</a></li>
                  <li class="list-inline-item"><a href="terms-of-service.html">Điều khoản sử dụng</a></li>
               </ul>
            </div>
            <div class="col-lg-6 text-right">
               Copyright 2020 <a href="#">TVteam</a> Đã đăng kí
            </div>
         </div>
      </div>
   </footer>
   <%- include ("boostrapJs.ejs") %>

      <script>
         let total = 0;
         function checkcart(e) {
            let checkbox = document.getElementsByName('checkbox')

            let arr = []
            let check = e.checked;

            let btnminus = e.parentElement.parentElement.parentElement.childNodes[7].childNodes[1].childNodes[1].children[0].childNodes[1].childNodes[1];
            let btninput = e.parentElement.parentElement.parentElement.childNodes[7].childNodes[1].childNodes[1].children[0].childNodes[1].childNodes[3];
            let btnplus = e.parentElement.parentElement.parentElement.childNodes[7].childNodes[1].childNodes[1].children[0].childNodes[1].childNodes[9];

            let price = e.parentElement.parentElement.parentElement.childNodes[7].childNodes[1].childNodes[1].children[0].childNodes[1].childNodes[7].value;
            let quantity = e.parentElement.parentElement.parentElement.childNodes[7].childNodes[1].childNodes[1].children[0].childNodes[1].childNodes[3].value;
            let tong = document.getElementById('total')
            if (check === true) {
               total += quantity * price
               btnminus.setAttribute('disabled', '');
               btninput.setAttribute('disabled', '');
               btnplus.setAttribute('disabled', '');

               tong.innerText = `${total.toLocaleString()} ₫`

            }

            else {
               total -= quantity * price
               btnminus.removeAttribute('disabled');
               btninput.removeAttribute('disabled');
               btnplus.removeAttribute('disabled')
               tong.innerText = `${total.toLocaleString()} ₫`

            }
         }
         function order(e) {
            let total = document.getElementById('total')
            let modal = document.getElementsByClassName('modal')[2]
            console.log(modal)

            if (total.innerText == "" || total.innerText == '0 ₫') {
               alert("Bạn chưa chọn sản phẩm")
               window.location.assign('/getcart')
            }
         }
         function sendata(e) {
            let price = e.parentElement.childNodes[7].value
            let soluong = e.value
            let total = soluong * price
            console.log(total, 'total')
            let id = e.parentElement.childNodes[5];
            let span = e.parentElement.parentElement.childNodes[3].childNodes[1]
            span.innerText = `${total.toLocaleString()} ₫`
            console.log(span)
            setTimeout(() => {
               fetch('updateCart', {
                  method: 'post',
                  headers: { 'content-type': 'application/json' },
                  body: JSON.stringify({ quantity: e.value, id: id.value })
               })
            }, 2000);

         }
         function send(e) {

            let id = e.parentElement.childNodes[5]
            let quantity = e.parentElement.childNodes[3]
            fetch('updateCart', {
               method: 'post',
               headers: { 'content-type': 'application/json' },
               body: JSON.stringify({ quantity: quantity.value, id: id.value })
            })


         }

      </script>
</body>

</html>